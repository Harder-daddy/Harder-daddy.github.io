<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>äº•å­—æ£‹ - ç„¡æ•µ AI</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f2f2f2;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

#app {
    display: flex;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    padding: 30px 40px;
}

#sidebar {
    width: 220px;
    padding-right: 40px;
}

#sidebar button {
    width: 100%;
    padding: 14px;
    margin-bottom: 18px;
    font-size: 18px;
    border-radius: 8px;
    border: none;
    background: #4a90e2;
    color: white;
    cursor: pointer;
}

#sidebar button:disabled {
    background: #aaa;
}

#board {
    display: grid;
    grid-template-columns: repeat(3, 140px);
    grid-template-rows: repeat(3, 140px);
    gap: 10px;
}

.cell {
    width: 140px;
    height: 140px;
    border: 3px solid #333;
    font-size: 80px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}

.cell.disabled {
    pointer-events: none;
    background: #eee;
}

/* çµæœæç¤ºæ¡† */
#resultModal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
}

#resultBox {
    background: white;
    padding: 30px 40px;
    border-radius: 10px;
    text-align: center;
}
</style>
</head>

<body>

<div id="app">
    <div id="sidebar">
        <button id="undoBtn" disabled>æ‚”æ£‹ï¼ˆ2ç§’å…§ï¼‰</button>
        <button id="resetBtn">é‡é–‹ä¸€å±€</button>
    </div>

    <div id="board"></div>
</div>

<div id="resultModal">
    <div id="resultBox">
        <h2 id="resultText"></h2>
        <button onclick="resetGame()">å†ç©ä¸€å±€</button>
    </div>
</div>

<script>
const boardEl = document.getElementById("board");
const undoBtn = document.getElementById("undoBtn");
const resetBtn = document.getElementById("resetBtn");
const resultModal = document.getElementById("resultModal");
const resultText = document.getElementById("resultText");

let board = Array(9).fill("");
let currentPlayer = "X"; // ç©å®¶
let lastMoveIndex = null;
let canUndo = false;
let undoTimer = null;
let gameOver = false;

const winPatterns = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

/* å»ºç«‹æ£‹ç›¤ */
function createBoard() {
    boardEl.innerHTML = "";
    board.forEach((val, idx) => {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = val;
        cell.dataset.index = idx;
        if (gameOver || currentPlayer === "O") {
            cell.classList.add("disabled");
        }
        cell.addEventListener("click", onPlayerMove);
        boardEl.appendChild(cell);
    });
}

/* ç©å®¶ä¸‹æ£‹ */
function onPlayerMove(e) {
    const idx = e.target.dataset.index;
    if (board[idx] || gameOver) return;

    makeMove(idx, "X");

    if (!gameOver) {
        setTimeout(() => {
            const best = getBestMoveMinimax();
            makeMove(best, "O");
        }, 400);
    }
}

/* è½å­ */
function makeMove(idx, player) {
    board[idx] = player;
    lastMoveIndex = idx;
    createBoard();
    startUndoTimer();

    if (checkWinner(player)) {
        endGame(player === "X" ? "ğŸ‰ ä½ è´äº†ï¼ï¼ˆå¥‡è¹Ÿï¼‰" : "ğŸ¤– ç„¡æ•µ AI ç²å‹ï¼");
        return;
    }

    if (board.every(c => c)) {
        endGame("ğŸ¤ å¹³æ‰‹ï¼ˆä½ çœŸçš„å¾ˆå¼·ï¼‰");
        return;
    }

    currentPlayer = player === "X" ? "O" : "X";
}

/* å‹è² åˆ¤å®š */
function checkWinner(player) {
    return winPatterns.some(p => p.every(i => board[i] === player));
}

/* Minimax ç„¡æ•µ AI */
function getBestMoveMinimax() {
    let bestScore = -Infinity;
    let move;

    board.forEach((cell, idx) => {
        if (!cell) {
            board[idx] = "O";
            let score = minimax(board, 0, false);
            board[idx] = "";
            if (score > bestScore) {
                bestScore = score;
                move = idx;
            }
        }
    });
    return move;
}

function minimax(newBoard, depth, isMax) {
    if (checkWinner("O")) return 10 - depth;
    if (checkWinner("X")) return depth - 10;
    if (newBoard.every(c => c)) return 0;

    if (isMax) {
        let best = -Infinity;
        newBoard.forEach((c, i) => {
            if (!c) {
                newBoard[i] = "O";
                best = Math.max(best, minimax(newBoard, depth + 1, false));
                newBoard[i] = "";
            }
        });
        return best;
    } else {
        let best = Infinity;
        newBoard.forEach((c, i) => {
            if (!c) {
                newBoard[i] = "X";
                best = Math.min(best, minimax(newBoard, depth + 1, true));
                newBoard[i] = "";
            }
        });
        return best;
    }
}

/* çµæŸéŠæˆ² */
function endGame(msg) {
    gameOver = true;
    resultText.textContent = msg;
    resultModal.style.display = "flex";
}

/* æ‚”æ£‹ï¼ˆ2 ç§’ï¼‰ */
function startUndoTimer() {
    canUndo = true;
    undoBtn.disabled = false;
    clearTimeout(undoTimer);
    undoTimer = setTimeout(() => {
        canUndo = false;
        undoBtn.disabled = true;
    }, 2000);
}

undoBtn.addEventListener("click", () => {
    if (!canUndo || gameOver) return;
    board[lastMoveIndex] = "";
    currentPlayer = "X";
    canUndo = false;
    undoBtn.disabled = true;
    createBoard();
});

/* é‡é–‹ */
resetBtn.addEventListener("click", resetGame);

function resetGame() {
    board = Array(9).fill("");
    currentPlayer = "X";
    gameOver = false;
    undoBtn.disabled = true;
    resultModal.style.display = "none";
    createBoard();
}

/* åˆå§‹åŒ– */
createBoard();
</script>

</body>
</html>
